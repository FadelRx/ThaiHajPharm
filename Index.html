<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Itim', sans-serif;
      background-color: #f8f9fa;
      background-size: cover;
      padding: 20px;
    }
    .container {
      background-color: #fff;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .form-section {
      background-color: #e9f7ef;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .form-title {
      font-size: 1.5rem;
      color: #28a745;
      margin-bottom: 20px;
      text-align: center;
    }
    .form-label {
      font-weight: bold;
      color: #495057;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .btn-group {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .btn-primary {
      background-color: #28a745;
      border: none;
    }
    .btn-secondary {
      background-color: #ffc107;
      border: none;
    }

    h2, h3, h4 {
      text-align: center;
      color: #2c3e50;
    }
    .btn-primary:hover {
      background-color: #283593;
      border-color: #283593;
    }
    .btn-success {
      background-color: #2e7d32;
      border-color: #2e7d32;
    }
    .btn-success:hover {
      background-color: #1b5e20;
      border-color: #1b5e20;
    }
    .btn-danger {
      background-color: #c62828;
      border-color: #c62828;
    }
    .btn-danger:hover {
      background-color: #b71c1c;
      border-color: #b71c1c;
    }
    .table-bordered th {
      background-color: #eceff1;
      color: #37474f;
      text-align: center;
    }
    /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
    table {
      font-size: 14px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
    }
    
    /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
    table td, table th {
      font-size: 14px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
      vertical-align: middle; /* ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    }
    footer {
      margin-top: 20px;
      text-align: center;
      color: #607d8b;
      font-size: 14px;
    }
    .form-select {
      background-color: #e3f2fd;
      border-radius: 8px;
    }
    .form-control {
      background-color: #fafafa;
      border-radius: 8px;
    }
    .form-label {
      font-weight: bold;
      color: #37474f;
    }
    .status-circle {
      display: inline-block;
      width: 20px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏° */
      height: 20px;
      border-radius: 50%; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° */
      margin-right: 8px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
    }

    .status-green { background-color: green; }
    .status-yellow { background-color: orange; }
    .status-red { background-color: red; }
    .status-gray { background-color: gray; }
    .table tbody td {
      text-align: center; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
      vertical-align: middle; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    }
    .warning-icon {
      display: inline-block;
      color: red;
      font-size: 16px;
      animation: blink 1s infinite;
      margin-left: 8px;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    .header-container {
      display: flex;
      align-items: center; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
      justify-content: space-between; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÅ‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
      padding: 10px;
    }

    .logo-left, .logo-right {
      width: 100px; /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
      height: auto;
    }

    .header-title {
      text-align: center;
      flex-grow: 1; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
    }
    /* Media Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
  @media (max-width: 768px) {
    .header-container {
      flex-direction: column; /* ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
      text-align: center;
    }

    .logo {
      width: 50px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ */
    }

    h2 {
      font-size: 1.5rem;
    }

    p {
      font-size: 0.9rem;
    }

    .container {
      padding: 10px; /* ‡∏•‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö */
    }
  }

  /* Media Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  @media (max-width: 480px) {
    .logo {
      width: 40px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏•‡∏á‡∏≠‡∏µ‡∏Å */
    }

    h2 {
      font-size: 1.2rem;
    }

    p {
      font-size: 0.8rem;
    }

    .container {
      padding: 5px;
    }
  }

  .statistics-section {
    background-color: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    margin-bottom: 15px;
  }

  .statistics-section.compact {
    padding: 5px;
    font-size: 14px;
  }

  .statistics-section h5 {
    margin-bottom: 8px;
    font-size: 16px;
    font-weight: bold;
    color: #343a40;
  }
  .statistics-section p {
    margin: 0;
    font-size: 12px;
  }
  .form-control-sm {
    font-size: 12px;
    height: 30px;
    padding: 5px;
  }
  .btn-sm {
    font-size: 12px;
    padding: 5px 10px;
  }

  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header-container">
      <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ -->
      <img src="https://img5.pic.in.th/file/secure-sv1/images-23439ca393195fba9.jpg" class="logo-left" alt="Logo Left">
      
      <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -->
      <div class="header-title">
        <h2>Drug-Related Problem Monitoring System</h2>
        <p class="text-center" style="color: #37474f;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏¢‡∏≤‡∏Æ‡∏∏‡∏à‡∏ç‡∏≤‡∏ï</p>
      </div>
      
      <!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤ -->
      <img src="https://img2.pic.in.th/pic/Untitled-design-17d64178ea3e904b6.png" class="logo-right" alt="Logo Right">
    </div>

    <!-- Login Section -->
    <div id="loginSection">
      <h3 class="text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
      <div class="mb-3">
        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
        <input type="text" id="username" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
      </div>
      <div class="mb-3">
        <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</label>
        <input type="password" id="password" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      </div>
      <button onclick="login()" class="btn btn-primary w-100">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <!-- <button onclick="showRegister()" class="btn btn-secondary w-100 mt-2">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button> -->
    </div>

    <!-- <div id="registerSection" style="display: none;">
      <h3>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
      <div class="mb-3">
        <label for="regUsername" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</label>
        <input type="text" id="regUsername" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
      </div>
      <div class="mb-3">
        <label for="regPassword" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:</label>
        <input type="password" id="regPassword" class="form-control" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç">
      </div>
      <div class="mb-3">
        <label for="regHospital" class="form-label">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•:</label>
        <select id="regHospital" class="form-select">
          <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• --</option>
        </select>
      </div>
      <button onclick="registerUser()" class="btn btn-success w-100">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
      <button onclick="showLogin()" class="btn btn-secondary w-100 mt-2">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div> -->
    
    <!-- Main Section -->
    <div id="mainSection" style="display:none;">
      <div class="d-flex justify-content-between align-items-center">
        <h3>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö: <span id="loggedInUser"></span></h3>
        <div>
          <button onclick="openAddForm()" class="btn btn-success btn-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          <button onclick="logout()" class="btn btn-danger btn-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-md-4">
          <input
            type="text"
            id="searchPatient"
            class="form-control"
            placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô ‡πÜ"
            onkeyup="filterPatients()"
          />
        </div>
        <div class="col-md-4">
          <select id="filterStatus" class="form-select" onchange="filterPatients()">
            <option value="">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
            <option value="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</option>
            <option value="‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
            <option value="‡πÅ‡∏î‡∏á">‡πÅ‡∏î‡∏á</option>
            <option value="‡πÄ‡∏ó‡∏≤">‡πÄ‡∏ó‡∏≤</option>
          </select>
        </div>
        <div class="col-md-4">
          <select id="filterDrugIssues" class="form-select" onchange="filterPatients()">
            <option value="">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤</option>
            <option value="ADR">ADR</option>
            <option value="DI">DI</option>
            <option value="Subtherapeutic">Subtherapeutic</option>
            <option value="Overdose">Overdose</option>
            <option value="Duplicate">Duplicate</option>
            <option value="Untreated indications">Untreated indications</option>
            <option value="Improper drug selection">Improper drug selection</option>
            <option value="Failure to receive drug">Failure to receive drug</option>
            <option value="Drug use without indication">Drug use without indication</option>
            <option value="do not ADR monitoring">do not ADR monitoring</option>
            
          </select>
        </div>
      </div>


      <!-- Add Button -->
      <div class="mt-4">
        <div class="statistics-section compact">
          <h5 class="text-center">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏™‡∏ß‡∏á‡∏ö‡∏∏‡∏ç</h5>
          <div class="row text-center">
            <div class="col-2">
              <p><strong>üåç ‡∏Æ‡∏∏‡∏à‡∏ç‡∏≤‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></p>
              <span id="totalPilgrims">6600</span><span>‡∏Ñ‡∏ô</span>
            </div>
            <div class="col-2">
              <p><strong>üë• ‡∏Æ‡∏∏‡∏à‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</strong></p>
              <span id="pilgrimsInCharge">0</span><span>‡∏Ñ‡∏ô</span>
            </div>
            <div class="col-2">
              <p><strong>üîç ‡∏Æ‡∏∏‡∏à‡∏ç‡∏≤‡∏ï‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á</strong></p>
              <span id="pilgrimsScreened">0</span><span>‡∏Ñ‡∏ô</span>
            </div>
            <div class="col-2">
              <p><strong>üìä %‡∏Æ‡∏∏‡∏à‡∏ç‡∏≤‡∏ï‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà/‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></p>
              <span id="responsiblePercentage">0%</span>
            </div>
            <div class="col-2">
              <p><strong>‚úÖ %‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á/‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</strong></p>
              <span id="screenedPercentage">0%</span>
            </div>
            <div class="col-2">
              <p><strong>üåü %‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á/‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</strong></p>
              <span id="screenedTotalPercentage">0%</span>
            </div>
          </div>
          <div class="row mt-2" id="editInputs" style="display: none;">
            <div class="col-6">
              <input type="number" id="editPilgrimsInCharge" class="form-control form-control-sm" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö">
            </div>
            <div class="col-6">
              <input type="number" id="editPilgrimsScreened" class="form-control form-control-sm" placeholder="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á">
            </div>
            <button onclick="updatePilgrimData()" class="btn btn-sm btn-primary mt-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </div>
          <div class="text-center mt-2">
            <div class="text-center mt-2">
              <button class="btn btn-primary btn-sm " onclick="toggleEditInputs()">‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á</button>
              <button onclick="showPilgrimChart()" class="btn btn-sm btn-secondary">‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü</button>
            </div>
          </div>
        </div>
        <p id="filteredCount" class="text-center">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: 0</p>
        
        <!-- Table -->
        <div class="table-responsive mt-3">
           <table class="table table-bordered">
            <thead>
              <tr>
                <th style="width: 15%;">‡∏ä‡∏∑‡πà‡∏≠</th>
                <th style="width: 20%;">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</th>
                <th style="width: 10%;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</th>
                <th style="width: 15%;">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤</th>
                <th style="width: 40%;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="patientsTable"></tbody>
          </table>

          <!-- Modal -->
            <div class="modal fade" id="patientModal" tabindex="-1" aria-labelledby="patientModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="patientModalLabel">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡∏≠‡∏á Modal -->
                    <p id="patientDetails"></p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal fade" id="careDetailsModal" tabindex="-1" aria-labelledby="careDetailsModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-lg">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="careDetailsModalLabel">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏ö‡∏≤‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏°</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body" id="careDetailsContent">
                    <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡∏≠‡∏á Modal ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Form -->
   <div id="formSection" class="form-section" style="display:none;">
      <h4 id="formTitle" class="form-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ</h4>
      <div class="form-group">
        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-user"></i></span>
          <input type="text" id="name" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
          <input type="text" id="address" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-hospital"></i></span>
          <input type="text" id="hospital" class="form-control" placeholder="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£" readonly>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-heartbeat"></i></span>
          <select id="status" class="form-select">
            <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
            <option value="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</option>
            <option value="‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</option>
            <option value="‡πÅ‡∏î‡∏á">‡πÅ‡∏î‡∏á</option>
            <option value="‡πÄ‡∏ó‡∏≤">‡πÄ‡∏ó‡∏≤</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-diagnoses"></i></span>
          <input type="text" id="disease" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-stethoscope"></i></span>
          <input type="text" id="symptoms" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-building"></i></span>
          <input type="text" id="company" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó">
        </div>
      </div>
      <div class="form-group">
        <label for="drugIssues" class="form-label">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤:</label>
        <div id="drugIssuesContainer" class="form-check">
          <div class="form-check">
            <input type="checkbox" id="issueADR" value="ADR" class="form-check-input">
            <label for="issueADR" class="form-check-label">ADR</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueDI" value="DI" class="form-check-input">
            <label for="issueDI" class="form-check-label">DI</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueSubtherapeutic" value="Subtherapeutic" class="form-check-input">
            <label for="issueSubtherapeutic" class="form-check-label">Subtherapeutic</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueOverdose" value="Overdose" class="form-check-input">
            <label for="issueOverdose" class="form-check-label">Overdose</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueDuplicate" value="Duplicate" class="form-check-input">
            <label for="issueDuplicate" class="form-check-label">Duplicate</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueUntreated indications" value="Untreated indications" class="form-check-input">
            <label for="issueUntreated indications" class="form-check-label">Untreated indications</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueImproper drug selection" value="Improper drug selection" class="form-check-input">
            <label for="issueImproper drug selection" class="form-check-label">Improper drug selection</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueFailure to receive drug" value="Failure to receive drug" class="form-check-input">
            <label for="issueFailure to receive drug" class="form-check-label">Failure to receive drug</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issueDrug use without indication" value="Drug use without indication" class="form-check-input">
            <label for="issueDrug use without indication" class="form-check-label">Drug use without indication</label>
          </div>
          <div class="form-check">
            <input type="checkbox" id="issuedo not ADR monitoring" value="do not ADR monitoring" class="form-check-input">
            <label for="issuedo not ADR monitoring" class="form-check-label">do not ADR monitoring</label>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-info-circle"></i></span>
          <textarea id="detail" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
        </div>
      </div>
      <div class="btn-group">
        <button onclick="savePatient()" class="btn btn-success">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="cancelForm()" class="btn btn-secondary">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      &copy; DPRMS | ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÇ‡∏î‡∏¢ FadelRx
    </footer>
  </div>
  
  <script>
    let currentUser = null;
    let patients = [];
    let editingIndex = null;
    document.addEventListener("DOMContentLoaded", () => {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      // ‡πÇ‡∏´‡∏•‡∏î‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
      setTimeout(() => {
        Swal.close(); // ‡∏õ‡∏¥‡∏î SweetAlert ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
      }, 2000);
    });

    function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      google.script.run.withSuccessHandler(response => {
        Swal.close();
        if (response.success) {
          currentUser = response.user; // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ currentUser
          document.getElementById('loggedInUser').textContent = currentUser.hospital;
          document.getElementById('loginSection').style.display = 'none';
          document.getElementById('mainSection').style.display = 'block';

          loadPatients(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ
          loadUserStatistics(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏™‡∏ß‡∏á‡∏ö‡∏∏‡∏ç
        } else {
          Swal.fire('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', 'error');
        }
      }).login(username, password);
    }

    function loadPatients() {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      google.script.run.withSuccessHandler(data => {
        Swal.close(); // ‡∏õ‡∏¥‡∏î SweetAlert ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
        patients = data;
        renderPatientsTable();
      }).getPatients(currentUser);
    }


     // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ render ‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function renderPatientsTable() {
      const tableBody = document.getElementById("patientsTable");
      tableBody.innerHTML = "";

      let totalPatientsCount = 0; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Group By

      const groupedPatients = patients.reduce((groups, patient) => {
        if (!groups[patient.hospital]) {
          groups[patient.hospital] = [];
        }
        groups[patient.hospital].push(patient);
        return groups;
      }, {});

      Object.keys(groupedPatients).forEach(hospital => {
        const groupHeaderRow = document.createElement("tr");
        groupHeaderRow.setAttribute('data-group', 'true'); // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡πà‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠ Group By
        groupHeaderRow.innerHTML = `
          <td colspan="5" style="background-color: #eceff1; font-weight: bold; text-align: left;">
            ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•: ${hospital}
          </td>
        `;
        tableBody.appendChild(groupHeaderRow);

        groupedPatients[hospital].forEach((patient, index) => {
          const row = document.createElement("tr");

          let statusClass = '';
          let warningIcon = '';
          switch (patient.status) {
            case '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß':
              statusClass = 'status-green';
              break;
            case '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á':
              statusClass = 'status-yellow';
              break;
            case '‡πÅ‡∏î‡∏á':
              statusClass = 'status-red';
              warningIcon = `<span class="warning-icon">‚ö†Ô∏è</span>`;
              break;
            case '‡πÄ‡∏ó‡∏≤':
              statusClass = 'status-gray';
              warningIcon = `<span class="warning-icon">‚ö†Ô∏è</span>`;
              break;
          }

          row.innerHTML = `
            <td>${patient.name}</td>
            <td>${patient.hospital}</td>
            <td><span class="status-circle ${statusClass}"></span>${patient.status} ${warningIcon}</td>
            <td>${patient.drugIssues.replace(/, /g, ', ')}</td> <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î -->
            <td>
              <button class="btn btn-info btn-sm me-2" onclick="showPatientDetails(${index})">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
              <button class="btn btn-success btn-sm me-2" onclick="openCareForm(${index})">Pharm Care+</button>
              <button class="btn btn-secondary btn-sm" onclick="viewCareDetails(${index})">Care Detail</button>
              ${
                currentUser.hospital !== 'Admin'
                  ? `
                  <button class="btn btn-warning btn-sm me-2" onclick="editPatient(${index})">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button class="btn btn-danger btn-sm" onclick="deletePatient(${index})">‡∏•‡∏ö</button>
                  `
                  : ''
              }
            </td>
          `;
          tableBody.appendChild(row);

          totalPatientsCount++; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß
        });
      });

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô DOM
      document.getElementById('filteredCount').textContent = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î DRP: ${totalPatientsCount}`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Modal ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    function showPatientDetails(index) {
      const patient = patients[index];
      const modal = new bootstrap.Modal(document.getElementById("patientModal"));
      document.getElementById("patientDetails").innerHTML = `
        <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${patient.name}<br>
        <strong>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•:</strong> ${patient.hospital}<br>
        <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${patient.address}<br>
        <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û:</strong> ${patient.status}<br>
        <strong>‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß:</strong> ${patient.disease}<br>
        <strong>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:</strong> ${patient.symptoms}<br>
        <strong>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</strong> ${patient.company}<br>
        <strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤:</strong> ${patient.drugIssues}<br>
        <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${patient.detail}
      `;
      modal.show();
    }

    function openAddForm() {
      editingIndex = null;
      document.getElementById('formSection').style.display = 'block';
      document.getElementById('mainSection').style.display = 'none';
      document.getElementById('formTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ';
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô editPatient
    function editPatient(index) {
      const patient = patients[index];

      document.getElementById('name').value = patient.name;
      document.getElementById('address').value = patient.address;
      document.getElementById('hospital').value = patient.hospital;
      document.getElementById('status').value = patient.status;
      document.getElementById('disease').value = patient.disease;
      document.getElementById('symptoms').value = patient.symptoms;
      document.getElementById('company').value = patient.company;

      const selectedIssues = patient.drugIssues.split(', '); // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏¢‡πå
      document.querySelectorAll('#drugIssuesContainer input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = selectedIssues.includes(checkbox.value); // ‡∏ï‡∏¥‡πä‡∏Å Checkbox ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      });

      document.getElementById('detail').value = patient.detail || '';

      editingIndex = index; // ‡πÄ‡∏Å‡πá‡∏ö index ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      document.getElementById('formSection').style.display = 'block';
      document.getElementById('mainSection').style.display = 'none';
    }

    function deletePatient(index) {
      const patient = patients[index];

      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
        text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '‡∏•‡∏ö',
        cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
            allowOutsideClick: false,
            didOpen: () => Swal.showLoading()
          });

          // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ Google Apps Script ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          google.script.run.withSuccessHandler(response => {
            Swal.close();
            if (response.success) {
              patients.splice(index, 1); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
              renderPatientsTable(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏ï‡∏≤‡∏£‡∏≤‡∏á
              Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } else {
              Swal.fire('‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', response.message, 'error');
            }
          }).deletePatient(patient.uniqueId);
        }
      });
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô savePatient
      function savePatient() {
      if (currentUser.hospital === 'Admin') {
        Swal.fire("‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï", "‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ", "warning");
        return;
      }

      const selectedIssues = Array.from(document.querySelectorAll('#drugIssuesContainer input[type="checkbox"]:checked'))
        .map(checkbox => checkbox.value); // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Checkbox ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡∏¥‡πä‡∏Å

      const patient = {
        uniqueId: editingIndex !== null ? patients[editingIndex].uniqueId : null, // ‡πÉ‡∏ä‡πâ UniqueID ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        name: document.getElementById('name').value,
        address: document.getElementById('address').value,
        hospital: currentUser.hospital || 'Admin',
        status: document.getElementById('status').value,
        disease: document.getElementById('disease').value,
        symptoms: document.getElementById('symptoms').value,
        company: document.getElementById('company').value,
        drugIssues: selectedIssues.join(', '), // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤
        detail: document.getElementById('detail').value,
      };

      if (editingIndex !== null) {
        patients[editingIndex] = patient; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå
      } else {
        patient.uniqueId = generateUniqueId(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á UniqueID ‡πÉ‡∏´‡∏°‡πà
        patients.push(patient); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå
      }

      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading()
      });

      google.script.run.withSuccessHandler(() => {
        Swal.close();
        renderPatientsTable();
        clearForm();
        cancelForm();
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
      }).savePatients(patients, currentUser);
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á UniqueID ‡πÉ‡∏ô‡∏ù‡∏±‡πà‡∏á JavaScript (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
    function generateUniqueId() {
      return 'H' + Math.random().toString(36).substr(2, 9);
    }

    function cancelForm() {
      document.getElementById('formSection').style.display = 'none';
      document.getElementById('mainSection').style.display = 'block';
      clearForm();
    }

    function logout() {
      currentUser = null; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ currentUser
      document.getElementById("loginSection").style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô login
      document.getElementById("mainSection").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å
      document.getElementById("formSection").style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°)
      
      Swal.fire({
        title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        icon: 'success',
        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
      });
    }

    function clearForm() {
      document.getElementById('name').value = '';
      document.getElementById('address').value = '';
      document.getElementById('hospital').value = currentUser.hospital || 'Admin';
      document.getElementById('status').value = '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß'; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      document.getElementById('disease').value = '';
      document.getElementById('symptoms').value = '';
      document.getElementById('company').value = '';
      document.getElementById('detail').value = '';

      // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏≤‡∏Å 'drugIssuesContainer' ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô DOM
      const drugIssuesCheckboxes = document.querySelectorAll('#drugIssuesContainer input[type="checkbox"]');
      if (drugIssuesCheckboxes) {
        drugIssuesCheckboxes.forEach(checkbox => checkbox.checked = false);
      }
    }


    function loadHospitals() {
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading(),
      });

      google.script.run.withSuccessHandler(hospitals => {
        Swal.close();
        const regHospital = document.getElementById("regHospital");
        regHospital.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• --</option>';
        hospitals.forEach(hospital => {
          const option = document.createElement("option");
          option.value = hospital;
          option.textContent = hospital;
          regHospital.appendChild(option);
        });
      }).getHospitals();
    }

    // function registerUser() {
    //   const username = document.getElementById("regUsername").value.trim();
    //   const password = document.getElementById("regPassword").value.trim();
    //   const hospital = document.getElementById("regHospital").value;

    //   if (!username || !password || !hospital) {
    //     Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "", "warning");
    //     return;
    //   }

    //   Swal.fire({
    //     title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...',
    //     allowOutsideClick: false,
    //     didOpen: () => Swal.showLoading(),
    //   });

    //   google.script.run.withSuccessHandler(response => {
    //     Swal.close();
    //     if (response.success) {
    //       Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß", "success").then(() => {
    //         showLogin();
    //       });
    //     } else {
    //       Swal.fire("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß", response.message, "error");
    //     }
    //   }).registerUser({ username, password, hospital });
    // }

    function showRegister() {
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("registerSection").style.display = "block";
      // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Register
      loadHospitals();
    }

    function showLogin() {
      document.getElementById("registerSection").style.display = "none";
      document.getElementById("loginSection").style.display = "block";
    }

    function searchPatients() {
      const searchValue = document.getElementById('searchPatient').value.toLowerCase();
      const tableBody = document.getElementById('patientsTable');
      const rows = tableBody.getElementsByTagName('tr');

      Array.from(rows).forEach(row => {
        const cells = row.getElementsByTagName('td');
        const rowData = Array.from(cells)
          .map(cell => cell.textContent.toLowerCase())
          .join(' ');
        if (rowData.includes(searchValue)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    function filterPatients() {
      const searchValue = document.getElementById('searchPatient').value.toLowerCase().trim();
      const filterStatus = document.getElementById('filterStatus').value.trim(); // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
      const filterDrugIssues = document.getElementById('filterDrugIssues').value.trim(); // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤
      const tableBody = document.getElementById('patientsTable');
      const rows = tableBody.getElementsByTagName('tr');

      let filteredCount = 0; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á

      Array.from(rows).forEach(row => {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ñ‡∏ß Group By ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const isGroupRow = row.getAttribute('data-group') === 'true';

        if (isGroupRow) {
          row.style.display = ''; // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß Group By ‡πÄ‡∏™‡∏°‡∏≠
          return; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ
        }

        const cells = row.getElementsByTagName('td');
        const name = cells[0]?.textContent.toLowerCase().trim() || ''; // ‡∏ä‡∏∑‡πà‡∏≠
        const status = cells[2]?.textContent.replace(/‚ö†Ô∏è/g, '').trim() || ''; // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
        const drugIssues = cells[3]?.textContent.trim() || ''; // ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏¢‡∏≤

        const matchesSearch = !searchValue || name.includes(searchValue);
        const matchesStatus = !filterStatus || status === filterStatus;
        const matchesDrugIssues = !filterDrugIssues || drugIssues === filterDrugIssues;

        if (matchesSearch && matchesStatus && matchesDrugIssues) {
          row.style.display = ''; // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
          filteredCount++; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
        } else {
          row.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
        }
      });

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
      document.getElementById('filteredCount').textContent = `‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${filteredCount}`;
    }
    function openCareForm(index) {
      const patient = patients[index];
      const careFormHtml = `
        <div>
          <h4>‡∏ö‡∏£‡∏¥‡∏ö‡∏≤‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏°: ${patient.name}</h4>
          <label>‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ:</label>
          <textarea id="medication" class="form-control" rows="4" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ ‡πÄ‡∏ä‡πà‡∏ô Paracetamol 500 mg 1 ‡πÄ‡∏°‡πá‡∏î ‡πÄ‡∏ä‡πâ‡∏≤-‡πÄ‡∏¢‡πá‡∏ô"></textarea>
          <label>‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤:</label>
          <input type="text" id="allergy" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤">
          <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏ö‡∏≤‡∏•:</label>
          <textarea id="careDetails" class="form-control" rows="4" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
          <button class="btn btn-success mt-3" onclick="savePharmaceuticalCare(${index})">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button class="btn btn-secondary mt-3" onclick="cancelCareForm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
      `;

      Swal.fire({
        title: '‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏ö‡∏≤‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏°',
        html: careFormHtml,
        showConfirmButton: false,
      });
    }

    function cancelCareForm() {
      Swal.close();
    }

    function savePharmaceuticalCare(index) {
      const patient = patients[index];
      const careData = {
        medication: document.getElementById('medication').value,
        allergy: document.getElementById('allergy').value,
        details: document.getElementById('careDetails').value,
      };

      if (!careData.medication || !careData.allergy || !careData.details) {
        Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "", "warning");
        return;
      }

      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading(),
      });

      google.script.run.withSuccessHandler(response => {
        Swal.close();
        if (response.success) {
          Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", response.message, "success");
        } else {
          Swal.fire("‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß", response.message, "error");
        }
      }).savePharmaceuticalCare(patient.uniqueId, careData);
    }

    function viewCareDetails(index) {
      const patient = patients[index];

      if (!patient.uniqueId) {
        Swal.fire("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏û‡∏ö UniqueID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ", "error");
        return;
      }

      // ‡πÅ‡∏™‡∏î‡∏á Loading
      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading(),
      });

      google.script.run.withSuccessHandler(jsonResponse => {
        Swal.close();
        const response = JSON.parse(jsonResponse);

        if (!response || !response.success) {
          Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', response.message || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'info');
          return;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        const formatTimestamp = (timestamp) => {
          const dateObj = new Date(timestamp);
          const day = String(dateObj.getDate()).padStart(2, '0');
          const month = String(dateObj.getMonth() + 1).padStart(2, '0'); // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 0
          const year = dateObj.getFullYear();
          const hours = String(dateObj.getHours()).padStart(2, '0');
          const minutes = String(dateObj.getMinutes()).padStart(2, '0');
          return `${day}-${month}-${year} ‡πÄ‡∏ß‡∏•‡∏≤ ${hours}:${minutes}`;
        };

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        const careDetailsHtml = response.history.map((care, i) => `
          <div>
            <h5>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${i + 1}</h5>
            <p><strong>‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:</strong> ${care.medication || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p>
            <p><strong>‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏¢‡∏≤:</strong> ${care.allergy || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p>
            <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${care.careDetails || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p>
            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</strong> ${care.timestamp ? formatTimestamp(care.timestamp) : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}</p>
            <hr>
          </div>
        `).join('');

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô Modal
        document.getElementById('careDetailsContent').innerHTML = careDetailsHtml;

        // ‡πÅ‡∏™‡∏î‡∏á Modal
        const modal = new bootstrap.Modal(document.getElementById('careDetailsModal'));
        modal.show();
      }).getPharmaceuticalHistory(patient.uniqueId);
    }
    function loadUserStatistics() {
      if (!currentUser || !currentUser.username) {
        console.error("currentUser ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ username");
        Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏™‡∏ß‡∏á‡∏ö‡∏∏‡∏ç‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
        return;
      }

      if (currentUser.hospital === 'Admin') {
        const screeningButton = document.querySelector('button[onclick="toggleEditInputs()"]');
        if (screeningButton) {
          screeningButton.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á
        }
        const editInputs = document.getElementById('editInputs');
        if (editInputs) {
          editInputs.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        }
      }

      google.script.run.withSuccessHandler(response => {
        if (response.success) {
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å response
          const totalPilgrims = response.totalPilgrims;
          const pilgrimsInCharge = response.pilgrimsInCharge;
          const pilgrimsScreened = response.pilgrimsScreened;

          // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
          const responsiblePercentage = ((pilgrimsInCharge / totalPilgrims) * 100).toFixed(2);
          const screenedPercentage = ((pilgrimsScreened / pilgrimsInCharge) * 100).toFixed(2);
          const screenedTotalPercentage = ((pilgrimsScreened / totalPilgrims) * 100).toFixed(2);

          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï DOM
          document.getElementById('totalPilgrims').textContent = totalPilgrims;
          document.getElementById('pilgrimsInCharge').textContent = pilgrimsInCharge;
          document.getElementById('pilgrimsScreened').textContent = pilgrimsScreened;
          document.getElementById('responsiblePercentage').textContent = `${responsiblePercentage}%`;
          document.getElementById('screenedPercentage').textContent = `${screenedPercentage}%`;
          document.getElementById('screenedTotalPercentage').textContent = `${screenedTotalPercentage}%`;
        } else {
          Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', response.message, 'error');
        }
      }).getUserStatistics(currentUser.username, currentUser.hospital === 'Admin');
    }



    function updatePilgrimData() {
      const newInCharge = parseInt(document.getElementById('editPilgrimsInCharge').value.trim(), 10);
      const newScreened = parseInt(document.getElementById('editPilgrimsScreened').value.trim(), 10);

      if (isNaN(newInCharge) || isNaN(newScreened)) {
        Swal.fire("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "error");
        return;
      }

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô Google Sheets ‡∏ú‡πà‡∏≤‡∏ô Google Apps Script
      const data = {
        username: currentUser.username,
        pilgrimsInCharge: newInCharge,
        pilgrimsScreened: newScreened,
      };

      Swal.fire({
        title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading(),
      });

      google.script.run
        .withSuccessHandler(response => {
          Swal.close();
          if (response.success) {
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô UI
            document.getElementById('pilgrimsInCharge').textContent = newInCharge;
            document.getElementById('pilgrimsScreened').textContent = newScreened;

            const totalPilgrims = parseInt(document.getElementById('totalPilgrims').textContent, 10);
            const responsiblePercentage = ((newInCharge / totalPilgrims) * 100).toFixed(2);
            const screenedPercentage = ((newScreened / newInCharge) * 100).toFixed(2);
            const screenedTotalPercentage = ((newScreened / totalPilgrims) * 100).toFixed(2);

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡πÉ‡∏ô UI
            document.getElementById('responsiblePercentage').textContent = `${responsiblePercentage}%`;
            document.getElementById('screenedPercentage').textContent = `${screenedPercentage}%`;
            document.getElementById('screenedTotalPercentage').textContent = `${screenedTotalPercentage}%`;

            const editInputs = document.getElementById('editInputs');
            editInputs.style.display = 'none';

            Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!", response.message, "success");
          } else {
            Swal.fire("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", response.message, "error");
          }
        })
        .withFailureHandler(error => {
          Swal.close();
          console.error('Error:', error);
          Swal.fire("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ", "error");
        })
        .updateUserStatistics(data);
    }



    function showPilgrimChart() {
      Swal.fire({
        title: '‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏™‡∏ß‡∏á‡∏ö‡∏∏‡∏ç',
        html: '<canvas id="popupPilgrimsChart" width="400" height="200"></canvas>',
        showCloseButton: true,
        showConfirmButton: false,
        width: '600px',
        didOpen: () => {
          const canvasElement = document.getElementById('popupPilgrimsChart');
          if (!canvasElement) {
            console.error("Canvas element ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô DOM");
            return;
          }

          const ctx = canvasElement.getContext('2d');

          // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å DOM
          const totalPilgrims = parseInt(document.getElementById('totalPilgrims').textContent, 10);
          const pilgrimsInCharge = parseInt(document.getElementById('pilgrimsInCharge').textContent, 10);
          const pilgrimsScreened = parseInt(document.getElementById('pilgrimsScreened').textContent, 10);

          // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
          const responsiblePercentage = ((pilgrimsInCharge / totalPilgrims) * 100).toFixed(2);
          const screenedPercentage = ((pilgrimsScreened / pilgrimsInCharge) * 100).toFixed(2);
          const screenedTotalPercentage = ((pilgrimsScreened / totalPilgrims) * 100).toFixed(2);

          // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: [
                '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
                '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á (‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö)',
                '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)'
              ],
              datasets: [{
                label: '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (%)',
                data: [responsiblePercentage, screenedPercentage, screenedTotalPercentage],
                backgroundColor: ['#28a745', '#ffc107', '#007bff'],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100
                }
              }
            }
          });
        }
      });
    }

    function toggleEditInputs() {
      const editInputs = document.getElementById('editInputs');
      const pilgrimsInCharge = document.getElementById('pilgrimsInCharge').textContent.trim();
      const pilgrimsScreened = document.getElementById('pilgrimsScreened').textContent.trim();

      if (editInputs.style.display === 'none') {
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö input
        document.getElementById('editPilgrimsInCharge').value = pilgrimsInCharge;
        document.getElementById('editPilgrimsScreened').value = pilgrimsScreened;

        // ‡πÅ‡∏™‡∏î‡∏á input
        editInputs.style.display = 'flex';
      } else {
        // ‡∏ã‡πà‡∏≠‡∏ô input
        editInputs.style.display = 'none';
      }
    }

  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
